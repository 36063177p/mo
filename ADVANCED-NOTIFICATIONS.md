# 🔔 نظام الإشعارات المتقدم للشحنات

## 📋 نظرة عامة

تم تطوير نظام إشعارات متقدم يرسل إشعارات تلقائية عند تغيير حالة الشحنة أو اقتراب المواعيد المهمة!

---

## ✨ أنواع الإشعارات المضافة

### 1. 🔄 إشعارات تغيير حالة الشحنة

#### الوظيفة:
```javascript
function sendShipmentStatusChangeNotification(shipmentNumber, oldStatus, newStatus)
```

#### المثال:
```javascript
sendShipmentStatusChangeNotification('SH001', 'تم التأكيد', 'تم الشحن');
// النتيجة: "تم تغيير حالة الشحنة SH001 من "تم التأكيد" إلى "تم الشحن""
```

#### الميزات:
- ✅ **رسالة واضحة** - تظهر الحالة القديمة والجديدة
- ✅ **أيقونة مناسبة** - `fas fa-shipping-fast`
- ✅ **لون مميز** - أزرق (#2196F3)
- ✅ **أولوية عالية** - priority: 'high'
- ✅ **إشعار سطح المكتب** - تلقائي

---

### 2. 🚚 إشعارات اقتراب موعد الوصول

#### الوظيفة:
```javascript
function sendArrivalReminderNotification(shipmentNumber, arrivalDate, daysLeft)
```

#### الأمثلة:
```javascript
// اليوم
sendArrivalReminderNotification('SH002', '2025-10-15', 0);
// النتيجة: "الشحنة SH002 تصل اليوم! تاريخ الوصول: 2025-10-15"

// غداً
sendArrivalReminderNotification('SH003', '2025-10-16', 1);
// النتيجة: "الشحنة SH003 تصل غداً! تاريخ الوصول: 2025-10-16"

// خلال أيام
sendArrivalReminderNotification('SH004', '2025-10-18', 3);
// النتيجة: "الشحنة SH004 تصل خلال 3 أيام. تاريخ الوصول: 2025-10-18"
```

#### الميزات:
- ✅ **رسائل ديناميكية** - تتغير حسب عدد الأيام
- ✅ **أيقونة شاحنة** - `fas fa-truck`
- ✅ **لون أخضر** - (#4CAF50)
- ✅ **تنبيه قبل 3 أيام** - من موعد الوصول
- ✅ **إشعار سطح المكتب** - تلقائي

---

### 3. 💳 إشعارات اقتراب موعد الدفع

#### الوظيفة:
```javascript
function sendPaymentReminderNotification(shipmentNumber, paymentDate, daysLeft)
```

#### الأمثلة:
```javascript
// اليوم
sendPaymentReminderNotification('SH005', '2025-10-12', 0);
// النتيجة: "موعد دفع الشحنة SH005 اليوم! تاريخ الدفع: 2025-10-12"

// غداً
sendPaymentReminderNotification('SH006', '2025-10-13', 1);
// النتيجة: "موعد دفع الشحنة SH006 غداً! تاريخ الدفع: 2025-10-13"

// خلال أيام
sendPaymentReminderNotification('SH007', '2025-10-15', 2);
// النتيجة: "موعد دفع الشحنة SH007 خلال 2 أيام. تاريخ الدفع: 2025-10-15"
```

#### الميزات:
- ✅ **رسائل ديناميكية** - تتغير حسب عدد الأيام
- ✅ **أيقونة بطاقة ائتمان** - `fas fa-credit-card`
- ✅ **لون برتقالي** - (#FF9800)
- ✅ **تنبيه قبل يومين** - من موعد الدفع
- ✅ **إشعار سطح المكتب** - تلقائي

---

### 4. 📄 إشعارات اقتراب موعد طلب الإفراج

#### الوظيفة:
```javascript
function sendReleaseRequestReminderNotification(shipmentNumber, releaseDate, daysLeft)
```

#### الأمثلة:
```javascript
// اليوم
sendReleaseRequestReminderNotification('SH008', '2025-10-14', 0);
// النتيجة: "موعد طلب إفراج الشحنة SH008 اليوم! تاريخ الطلب: 2025-10-14"

// غداً
sendReleaseRequestReminderNotification('SH009', '2025-10-15', 1);
// النتيجة: "موعد طلب إفراج الشحنة SH009 غداً! تاريخ الطلب: 2025-10-15"

// خلال أيام
sendReleaseRequestReminderNotification('SH010', '2025-10-17', 2);
// النتيجة: "موعد طلب إفراج الشحنة SH010 خلال 2 أيام. تاريخ الطلب: 2025-10-17"
```

#### الميزات:
- ✅ **رسائل ديناميكية** - تتغير حسب عدد الأيام
- ✅ **أيقونة ملف تصدير** - `fas fa-file-export`
- ✅ **لون بنفسجي** - (#9C27B0)
- ✅ **تنبيه قبل يومين** - من موعد الطلب
- ✅ **إشعار سطح المكتب** - تلقائي

---

## 🔍 نظام الفحص التلقائي

### فحص المواعيد:
```javascript
function checkAndSendReminderNotifications()
```

#### آلية العمل:
1. **فحص جميع الشحنات** - البحث عن `.shipment-card`
2. **استخراج التواريخ** - من العناصر المحددة
3. **حساب الأيام المتبقية** - مقارنة مع التاريخ الحالي
4. **إرسال الإشعارات** - حسب القواعد المحددة

#### القواعد:
- **موعد الوصول**: تنبيه قبل 0-3 أيام
- **موعد الدفع**: تنبيه قبل 0-2 أيام
- **موعد طلب الإفراج**: تنبيه قبل 0-2 أيام

### تشغيل الفاحص:
```javascript
function startReminderChecker()
```

#### الميزات:
- ✅ **فحص فوري** - عند التشغيل
- ✅ **فحص كل ساعة** - تلقائي
- ✅ **تسجيل في Console** - لتتبع العملية
- ✅ **تشغيل تلقائي** - عند تحميل الصفحة

---

## 🛠️ الدوال المساعدة

### تحديث حالة الشحنة مع إشعار:
```javascript
async function updateShipmentStatusWithNotification(shipmentNumber, newStatus)
```

#### الميزات:
- ✅ **الحصول على الحالة القديمة** - من قاعدة البيانات
- ✅ **تحديث قاعدة البيانات** - الحالة الجديدة
- ✅ **إرسال إشعار** - تغيير الحالة
- ✅ **إعادة تحميل البيانات** - تحديث الواجهة
- ✅ **رسالة نجاح** - تأكيد العملية

### اختبار الإشعارات:
```javascript
function testAdvancedNotifications()
```

#### الإشعارات التجريبية:
- ✅ **تغيير حالة** - SH001 من "تم التأكيد" إلى "تم الشحن"
- ✅ **اقتراب الوصول** - SH002 خلال يومين
- ✅ **اقتراب الدفع** - SH003 غداً
- ✅ **اقتراب الإفراج** - SH004 اليوم

---

## 🎨 تصميم الإشعارات

### الألوان والأيقونات:

| نوع الإشعار | اللون | الأيقونة | الوصف |
|-------------|-------|----------|--------|
| **تغيير الحالة** | #2196F3 | `fas fa-shipping-fast` | أزرق - شحن سريع |
| **اقتراب الوصول** | #4CAF50 | `fas fa-truck` | أخضر - شاحنة |
| **اقتراب الدفع** | #FF9800 | `fas fa-credit-card` | برتقالي - بطاقة ائتمان |
| **اقتراب الإفراج** | #9C27B0 | `fas fa-file-export` | بنفسجي - ملف تصدير |

### الخصائص المشتركة:
- ✅ **أولوية عالية** - priority: 'high'
- ✅ **معرف الشحنة** - shipmentId
- ✅ **إشعار سطح المكتب** - تلقائي
- ✅ **تسجيل في Console** - للتتبع

---

## 🚀 كيفية الاستخدام

### اختبار الإشعارات:
1. افتح التطبيق في المتصفح
2. انتقل إلى تبويب "الشحنات"
3. اضغط على زر "اختبار الإشعارات"
4. ستظهر 4 إشعارات تجريبية مختلفة

### مراقبة الإشعارات:
1. افتح لوحة الإشعارات (أيقونة الجرس)
2. ستجد جميع الإشعارات المرسلة
3. يمكنك قراءة الإشعارات أو حذفها

### إعدادات الإشعارات:
1. اضغط على أيقونة الإعدادات في لوحة الإشعارات
2. فعّل/ألغِ أنواع الإشعارات المختلفة
3. اختر صوت الإشعار المفضل
4. فعّل إشعارات سطح المكتب

---

## 📊 النتيجة النهائية

### قبل التطوير:
- ❌ لا توجد إشعارات تلقائية
- ❌ لا يوجد تنبيه للمواعيد
- ❌ لا يوجد إشعار لتغيير الحالات
- ❌ نظام إشعارات أساسي فقط

### بعد التطوير:
- ✅ **إشعارات تغيير الحالة** - تلقائية عند التحديث
- ✅ **إشعارات اقتراب الوصول** - قبل 3 أيام
- ✅ **إشعارات اقتراب الدفع** - قبل يومين
- ✅ **إشعارات اقتراب الإفراج** - قبل يومين
- ✅ **فحص تلقائي** - كل ساعة
- ✅ **ألوان وأيقونات مميزة** - لكل نوع
- ✅ **إشعارات سطح المكتب** - تلقائية
- ✅ **نظام اختبار** - للإشعارات التجريبية

---

## 📝 ملاحظات مهمة

### التوافق:
- ✅ يعمل مع نظام الإشعارات الموجود
- ✅ متوافق مع Firebase Cloud Messaging
- ✅ دعم إشعارات سطح المكتب
- ✅ دعم الأصوات المخصصة

### الأداء:
- ✅ فحص ذكي - فقط للشحنات الموجودة
- ✅ حساب دقيق للأيام المتبقية
- ✅ عدم تكرار الإشعارات
- ✅ تشغيل في الخلفية

### الصيانة:
- ✅ كود منظم ومعلّق
- ✅ دوال منفصلة لكل نوع
- ✅ سهولة إضافة أنواع جديدة
- ✅ نظام اختبار شامل

---

**تم التطوير:** 8 أكتوبر 2025  
**الإصدار:** 2.1.4  
**الحالة:** ✅ مكتمل

نظام الإشعارات المتقدم الآن يعمل بشكل مثالي! 🔔
